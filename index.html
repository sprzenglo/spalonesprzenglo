<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>wielka księga sprzengla</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: 'Times New Roman', Times, serif; background: #f8f8f8; margin: 0; }
    .header { background: #2908ce; color: white; padding: 20px; text-align: center; font-size: 2em; font-weight: bold; }
    .search-bar { display: flex; justify-content: center; margin: 20px 0; }
    .search-bar input { width: 300px; font-size: 1em; padding: 8px; }
    .contents { max-width: 900px; margin: 0 auto; background: #fff; border: 1px solid #222; box-shadow: none; padding: 20px; }
    .category { margin-bottom: 20px; }
    .category-title { font-size: 1.2em; font-weight: bold; margin-bottom: 10px; cursor: pointer; background: #eaeaea; border: 1px solid #222; padding: 8px; }
    .article-list { display: none; flex-direction: column; gap: 0; border: none; margin-top: 0; }
    .article-link { background: none; border: none; padding: 0; text-decoration: underline; color: #010de7; font-size: 1em; display: block; text-align: left; margin: 4px 0; }
    .article-link:hover { color: #022d69; transform: scale(1.01);}
    .category.open .article-list { display: flex; }
    .photo { display: flex; align-items: right;}
  </style>
</head>
<body>

<div class="header">wielka księga sprzengla</div>
<button id="open-auth-btn" onclick="showAuthSection()" style="position:fixed;top:16px;right:16px;z-index:1000;padding:8px 16px;font-size:1em;">Login/Register</button>

<div id="auth-section" style="max-width:400px;margin:20px auto 0 auto;padding:20px;background:#fff;border:1px solid #222;box-shadow:0 2px 8px rgba(0,0,0,0.08);display:none;">
  <div id="login-form">
    <h3>Zaloguj się lub zarejestruj</h3>
    <input type="text" id="username" placeholder="Nazwa użytkownika" style="width:100%;margin-bottom:8px;padding:6px;">
    <input type="password" id="password" placeholder="Hasło" style="width:100%;margin-bottom:8px;padding:6px;">
    <button onclick="login()">Zaloguj</button>
    <button onclick="register()">Zarejestruj</button>
    <div style="margin-top:8px;font-size:0.95em;">
      <a href="terms.html" target="_blank">Akceptuję <u>regulamin</u></a>
    </div>
    <div id="auth-msg" style="color:red;margin-top:8px;"></div>
  </div>
  <div id="user-panel" style="display:none;">
    <span id="welcome-msg"></span>
    <button onclick="logout()">Wyloguj</button>
    <div id="user-actions"></div>
  </div>
</div>

<div class="search-bar" style="position:relative;">
  <input type="text" id="search" placeholder="Szukaj artykułu..." autocomplete="off" oninput="showSuggestions()" onkeydown="searchKeyDown(event)">
  <button onclick="searchGo()">Szukaj</button>
  <ul id="suggestions" style="position:absolute; left:0; background:#fff; border:1px solid #222; width:300px; list-style:none; margin:0; padding:0; z-index:10; display:none;"></ul>
</div>

<div style="display: flex; align-items: flex-start; max-width: 1200px; margin: 0 auto;">
  <div class="contents" style="flex: 1;">
    <!-- Wszystkie kategorie i artykuły tak jak w Twoim HTML -->
    <div class="category" id="cat-animals">
      <div class="category-title" onclick="toggleCategory('cat-animals')">Zwierzęta ▼</div>
      <div class="article-list">
        <a class="article-link" href="pipotam.html">Pipotam</a>
        <a class="article-link" href="animal1.html">Meowl</a>
        <a class="article-link" href="animal2.html">homik</a>
        <a class="article-link" href="animal3.html">kuc z bronksu</a>
      </div>
    </div>
    <div class="category" id="cat-cars">
      <div class="category-title" onclick="toggleCategory('cat-cars')">top samochody oat ▼</div>
      <div class="article-list">
        <a class="article-link" href="car1.html">Civic 4th Generation</a>
        <a class="article-link" href="car2.html">Porsche 935</a>
        <a class="article-link" href="car3.html">golf4 aka rakieta</a>
        <a class="article-link" href="car4.html">Car 4</a>
        <a class="article-link" href="car5.html">Car 5</a>
        <a class="article-link" href="car6.html">Car 6</a>
        <a class="article-link" href="car7.html">Car 7</a>
        <a class="article-link" href="car8.html">Car 8</a>
      </div>
    </div>
    <div class="category" id="cat-memes">
      <div class="category-title" onclick="toggleCategory('cat-memes')">śmieszne obrazki ▼</div>
      <div class="article-list">
        <a class="article-link" href="meme1.html">67 dziecko</a>
        <a class="article-link" href="meme2.html">Meme 2</a>
        <a class="article-link" href="meme3.html">Meme 3</a>
        <a class="article-link" href="meme4.html">Meme 4</a>
        <a class="article-link" href="meme5.html">Meme 5</a>
        <a class="article-link" href="meme6.html">Meme 6</a>
        <a class="article-link" href="meme7.html">Meme 7</a>
        <a class="article-link" href="meme8.html">Meme 8</a>
      </div>
    </div>
    <!-- pozostałe kategorie w tym samym stylu -->
  </div>
  <div>
    <img src="pipotam.gif" alt="pipotam" style="max-width:220px; margin-left:30px; border:1px solid #222;">
    <br>
    <img src="meowl.webp" alt="meowl" style="max-width:220px; margin-left:30px; border:1px solid #222;">
  </div>
</div>

<script>
const API_BASE = 'https://spalonesprzenglo-backend.onrender.com'; // Twój backend

// Show/hide auth section
function showAuthSection() { document.getElementById('auth-section').style.display='block'; document.getElementById('open-auth-btn').style.display='none'; }
function hideAuthSection() { document.getElementById('auth-section').style.display='none'; document.getElementById('open-auth-btn').style.display='block'; }

// Collapsible categories
function toggleCategory(id) { document.getElementById(id).classList.toggle('open'); }
document.getElementById('cat-animals').classList.add('open');

// Search
let articles = [];
window.addEventListener('DOMContentLoaded', () => {
  articles = Array.from(document.querySelectorAll('.article-link')).map(a => ({name:a.textContent.trim(), link:a.getAttribute('href')}));
  loadAuth();
});

function showSuggestions() {
  const input = document.getElementById('search').value.trim().toLowerCase();
  const sugg = document.getElementById('suggestions');
  const searchInput = document.getElementById('search');
  if (!input) { sugg.style.display='none'; sugg.innerHTML=''; return; }
  const matches = articles.filter(a => a.name.toLowerCase().includes(input)).slice(0,5);
  if (!matches.length) { sugg.style.display='none'; sugg.innerHTML=''; return; }
  sugg.innerHTML = matches.map(a => `<li style='padding:6px; cursor:pointer;' onclick="window.location.href='${a.link}'">${a.name}</li>`).join('');
  sugg.style.left = searchInput.offsetLeft+'px';
  sugg.style.top = (searchInput.offsetTop+searchInput.offsetHeight)+'px';
  sugg.style.display='block';
}

function searchGo() {
  const input = document.getElementById('search').value.trim().toLowerCase();
  if (!input) return;
  const match = articles.find(a=>a.name.toLowerCase()===input)||articles.find(a=>a.name.toLowerCase().includes(input));
  if(match) window.location.href=match.link;
}

function searchKeyDown(e) { if(e.key==='Enter') searchGo(); }
document.addEventListener('click', e => { if(!document.getElementById('search').contains(e.target)) document.getElementById('suggestions').style.display='none'; });

// --- Auth & Article Logic ---
let currentUser = null;
let pendingArticles = [];

async function register() {
  const u=document.getElementById('username').value.trim();
  const p=document.getElementById('password').value;
  if(!u||!p){showAuthMsg('Podaj nazwę i hasło');return;}
  const res = await fetch(API_BASE+'/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
  const data = await res.json();
  if(data.success){currentUser=u; localStorage.setItem('currentUser',currentUser); showAuthMsg(''); loadAuth(); } 
  else showAuthMsg(data.msg||'Błąd rejestracji');
}

async function login() {
  const u=document.getElementById('username').value.trim();
  const p=document.getElementById('password').value;
  if(!u||!p){showAuthMsg('Podaj nazwę i hasło');return;}
  const res=await fetch(API_BASE+'/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
  const data=await res.json();
  if(data.success){currentUser=u; localStorage.setItem('currentUser',currentUser); showAuthMsg(''); loadAuth(); }
  else showAuthMsg(data.msg||'Błędna nazwa lub hasło');
}

function logout(){ currentUser=null; localStorage.removeItem('currentUser'); hideAuthSection(); loadAuth(); }
function showAuthMsg(msg){document.getElementById('auth-msg').textContent=msg;}

async function loadAuth() {
  currentUser = localStorage.getItem('currentUser');
  if(currentUser){
    document.getElementById('login-form').style.display='none';
    document.getElementById('user-panel').style.display='block';
    document.getElementById('welcome-msg').textContent='Witaj, '+currentUser+'!';
    await loadUserActions();
    document.getElementById('auth-section').style.display='block';
    document.getElementById('open-auth-btn').style.display='none';
  } else {
    document.getElementById('login-form').style.display='block';
    document.getElementById('user-panel').style.display='none';
    document.getElementById('auth-section').style.display='none';
    document.getElementById('open-auth-btn').style.display='block';
  }
}

async function loadUserActions(){
  const panel=document.getElementById('user-actions');
  if(currentUser==='sprzenglo'){
    const res=await fetch(API_BASE+'/pending');
    const pending=await res.json();
    panel.innerHTML=`<h4>Panel admina: oczekujące artykuły</h4>`+(pending.length===0?'<i>Brak oczekujących artykułów</i>':
      '<ul>'+pending.map((a,i)=>`<li><b>${a.title}</b> (${a.category})<br>${a.content}<br><button onclick='acceptArticle("${a._id}")'>Akceptuj</button> <button onclick='deleteArticle("${a._id}")'>Usuń</button> <span style="font-size:0.9em;color:#888;">autor: ${a.author}</span></li>`).join('')+'</ul>');
  } else {
    panel.innerHTML=`<h4>Dodaj artykuł</h4>
      <select id='article-category'>
        <option value='Zwierzęta'>Zwierzęta</option>
        <option value='top samochody oat'>top samochody oat</option>
        <option value='śmieszne obrazki'>śmieszne obrazki</option>
        <option value='Kategoria 4'>Kategoria 4</option>
        <option value='Kategoria 5'>Kategoria 5</option>
      </select><br>
      <input type='text' id='article-title' placeholder='Tytuł artykułu' style='width:100%;margin:6px 0;'><br>
      <textarea id='article-content' placeholder='Treść artykułu' style='width:100%;height:80px;'></textarea><br>
      <button onclick='submitArticle()'>Wyślij do akceptacji</button>
      <div id='user-article-msg' style='color:green;margin-top:8px;'></div>`;
  }
}

async function submitArticle(){
  const cat=document.getElementById('article-category').value;
  const title=document.getElementById('article-title').value.trim();
  const content=document.getElementById('article-content').value.trim();
  if(!title||!content){document.getElementById('user-article-msg').textContent='Podaj tytuł i treść artykułu';return;}
  const res=await fetch(API_BASE+'/article',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({author:currentUser,category:cat,title,content})});
  const data=await res.json();
  if(data.success){document.getElementById('user-article-msg').textContent='Artykuł wysłany do akceptacji!'; loadUserActions(); }
  else document.getElementById('user-article-msg').textContent=data.msg||'Błąd';
}

async function acceptArticle(id){ await fetch(API_BASE+'/approve',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id})}); loadUserActions(); }
async function deleteArticle(id){ await fetch(API_BASE+'/delete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id})}); loadUserActions(); }
</script>

</body>
</html>
